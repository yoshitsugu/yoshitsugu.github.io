<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <title>Haskell Servant, HRR, ElmでSPAを作っている - TSUGULOG</title>
        <meta name="description" content="yoshitsugu's blog">
        <link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
        <link rel="icon" href="../images/favicon.ico" type="image/x-icon">
        <meta property="og:title" content="Haskell Servant, HRR, ElmでSPAを作っている - TSUGULOG" />
        <meta property="og:type" content="blog" />
        <meta property="og:image" content="https://yoshitsugu.net/images/title.png" />
        <meta property="og:site_name" content="TSUGULOG" />
        <meta property="og:url" content="https://yoshitsugu.net/posts/2016-03-27-servant-hrr-elm-spa.html" />
        <meta property="og:description" content="
    Posted on 2016-03-27
    
    
    , Tags: haskell-servant, haskell-relational-query, Elm
    


Typed up CRUD SPA with Haskell and Elmの記事に触発される形で最近SPAを作りはじめた。" />
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@_yoshitsugu" />
        <meta name="twitter:title" content="Haskell Servant, HRR, ElmでSPAを作っている - TSUGULOG" />
        <meta name="twitter:image" content="https://yoshitsugu.net/images/title.png" />
        <meta name="twitter:description" content="
    Posted on 2016-03-27
    
    
    , Tags: haskell-servant, haskell-relational-query, Elm
    


Typed up CRUD SPA with Haskell and Elmの記事に触発される形で最近SPAを作りはじめた。" />
        <link rel="stylesheet" href="../css/pure-min.css">
        <link rel="stylesheet" href="../css/grids-responsive-min.css">
        <link rel="stylesheet" href="../css/blog.css">
        <link rel="stylesheet" href="../css/highlight.css">
        <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    </head>
    <body>
        <div id="wrapper">
            <div id="container">
                <header id="header" class="pure-menu pure-menu-horizontal">
                    <div id="logo" class="pure-menu-heading pure-menu-link">
                        <a href="../" class="pure-menu-link">TSUGULOG</a>
                    </div>
                    <ul class="pure-menu-list header-menu">
                        <li class="pure-menu-item"><a href="../" class="pure-menu-link">Home</a></li>
                        <li class="pure-menu-item"><a href="../archive.html" class="pure-menu-link">Archive</a></li>
                        <li class="pure-menu-item"><a href="../about.html" class="pure-menu-link">About</a></li>
                    </ul>
                </header>
                <div id="content">
                    <h1>Haskell Servant, HRR, ElmでSPAを作っている</h1>
                    
                    <div class="info">
    <span class="date">Posted on 2016-03-27</span>
    
    
    <span class="tags">, Tags: <a title="All pages tagged 'haskell-servant'." href="../tags/haskell-servant.html">haskell-servant</a>, <a title="All pages tagged 'haskell-relational-query'." href="../tags/haskell-relational-query.html">haskell-relational-query</a>, <a title="All pages tagged 'Elm'." href="../tags/Elm.html">Elm</a></span>
    
</div>

<p><a href="http://rundis.github.io/blog/2015/haskell_elm_spa_part1.html" target="_blank">Typed up CRUD SPA with Haskell and Elm</a>の記事に触発される形で最近SPAを作りはじめた。<!--more--></p>
<h2 id="ソース">ソース</h2>
<p>自分用のチュートリアルコードなので、晒すのもためらわれるが、載せておく。 <a href="https://github.com/yoshitsugu/hagemai" target="_blank">https://github.com/yoshitsugu/hagemai</a></p>
<h2 id="作りたいもの">作りたいもの</h2>
<p><a href="http://www.daifukuya.com/kagemai/" target="_blank">影舞</a>をご存知だろうか。シンプルだが結構つかいやすいバグトラッキングシステムである。今回はこれを目標に作りはじめてみた。<br />
おおまかな機能として以下のようなものがある。</p>
<ul>
<li>バグを登録できる。</li>
<li>バグに関連するやりとりを追加できる。
<ul>
<li>やりとりメッセージの追加時にバグ自体の状態も変更できる。</li>
</ul></li>
<li>バグの状態管理(受付中、確認中、など)ができる。
<ul>
<li>影舞では状態を動的に増やすことができる。</li>
</ul></li>
</ul>
<p>尚、Haskellでつくる影舞、ということでHagemaiという名前にしたが、特に毛髪関連の他意はない。</p>
<h2 id="使用する技術要素">使用する技術要素</h2>
<p>シンプルなシステムにはオーバーエンジニアリングなのは重々承知だが、勉強のため、SPAで作る。</p>
<ul>
<li>バックエンドはHaskell
<ul>
<li>APIサーバには<a href="https://haskell-servant.github.io/" target="_blank">haskell-servant</a>を使う。
<ul>
<li>APIを型で表現できる。</li>
</ul></li>
<li>DBとのやりとりには<a href="https://khibino.github.io/haskell-relational-record/" target="_blank">haskell-relational-record</a>(HRR)を使う
<ul>
<li>仕組みがまだよくわかっていないのだが、SQLに型をつけることでコンパイル時に正しいSQL文なのかチェックできる。</li>
</ul></li>
</ul></li>
<li>フロントエンドは<a href="http://elm-lang.org/" target="_blank">Elm</a>
<ul>
<li>Haskellライクなシンタックスを持つAltJSで、FRPのフレームワークをあつかえる。</li>
</ul></li>
</ul>
<h2 id="進捗">進捗</h2>
<p>とりあえすバグの登録とコメントの追加はできた。</p>
<ul>
<li>見た目は<a href="https://nkmr6194.github.io/Umi/" target="_blank">Umi</a>をつかっている。</li>
<li>レイアウトは現在のところ結構適当だ。</li>
</ul>
<h3 id="バグの登録">バグの登録</h3>
<p><img src="../images/hagemai_create.gif" class="blog-img img-responsive"></p>
<h3 id="コメントの追加">コメントの追加</h3>
<p>影舞と同じように、タイトル、優先度などバグ自体もここで更新できる。 <img src="../images/hagemai_create_comment.gif" class="blog-img img-responsive"></p>
<h2 id="ここまで作った感想など">ここまで作った感想など</h2>
<h3 id="影舞意外と高機能">影舞意外と高機能</h3>
<p>シンプルだと思っていたけど、意外といろいろやっていることが細かく見ていくとわかった。</p>
<ul>
<li>そもそも状態数を任意に増やせる設計にするのは割と面倒。</li>
<li>各コメントにページ内リンクつけてる</li>
<li>captca機能がある？未確認</li>
</ul>
<h3 id="hdbc-mysqlの問題">HDBC-MySQLの問題？</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Exception</span><span class="op">:</span> <span class="dt">SqlError</span> {seState <span class="ot">=</span> <span class="st">&quot;&quot;</span>, seNativeError <span class="ot">=</span> <span class="dv">2014</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>seErrorMsg <span class="ot">=</span> <span class="st">&quot;Commands out of sync; you can't run this command now&quot;</span>}</span></code></pre></div>
<p>というエラーがでてハマった。</p>
<ul>
<li><a href="http://blog.xaxxi.net/2014/02/08/hdbc-mysql%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AE%E3%81%8C%E9%9B%A3%E3%81%97%E3%81%84/" target="_blank">HDBC-mysqlを使うのが難しい</a></li>
<li><a href="http://stackoverflow.com/questions/8027948/hdbc-mysql-command-out-of-sync" target="_blank">HDBC-mysql “command out of sync”</a></li>
</ul>
<p>このあたりの問題っぽいけど自分のtransactionの使い方が間違っている気もする。</p>
<h3 id="haskell---elm-の差">Haskell &lt;-&gt; Elm の差</h3>
<p>同じっぽいけど微妙に違うシンタックスなので、HaskellとElmのコードを行き来していると結構イラっとする。</p>
<h3 id="何はともあれ楽しい">何はともあれ楽しい。</h3>
<p>コンパイル通った時の安心感はやはりHaskell, Elmのメリットだとおもう。あと、リファクタリングとかも型でどこを直せばいいかわかりやすいので、やりやすいような気がする。</p>
<h2 id="今後">今後</h2>
<p>SPAは仕事ではほとんど作ったことがなく、せっかくなので知見をためておきたい。<br />
とりあえず飽きるまではやる。そもそもがオーバーエンジニアリングなやつなので、今のところ特にちゃんとした製品にしようとは考えていない。</p>

<div class="social-buttons">
<a href="http://b.hatena.ne.jp/entry/https://yoshitsugu.net/posts/2016-03-27-servant-hrr-elm-spa.html" class="hatena-bookmark-button" data-hatena-bookmark-title="Haskell Servant, HRR, ElmでSPAを作っている - TSUGULOG" data-hatena-bookmark-layout="standard-noballoon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<a href="https://twitter.com/share" class="twitter-share-button" data-via="_yoshitsugu">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>

                    
                </div>
            </div>
            <footer id="footer">
                &copy; 2016 Kota Yoshitsugu <br>
                This site is powered by
                <a href="http://jaspervdj.be/hakyll" target="_blank">Hakyll</a>
                , <a href="http://purecss.io/" target="_blank">Pure.css</a>
        </footer>
        
      </div>
    </body>
</html>
