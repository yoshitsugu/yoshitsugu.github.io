<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <title>chrootベースのjailをRustで作ってみる - TSUGULOG</title>
        <meta name="description" content="yoshitsugu's blog">
        <link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
        <link rel="icon" href="../images/favicon.ico" type="image/x-icon">
        <meta property="og:title" content="chrootベースのjailをRustで作ってみる - TSUGULOG" />
        <meta property="og:type" content="blog" />
        <meta property="og:image" content="https://yoshitsugu.net/images/title.png" />
        <meta property="og:site_name" content="TSUGULOG" />
        <meta property="og:url" content="https://yoshitsugu.net/posts/2018-03-22-jailing-in-rust.html" />
        <meta property="og:description" content="
    Posted on 2018-03-22
    
    
    , Tags: Rust, jailing
    


jailing をRustに置き換えながらjail構築の処理を追ってみた。" />
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@_yoshitsugu" />
        <meta name="twitter:title" content="chrootベースのjailをRustで作ってみる - TSUGULOG" />
        <meta name="twitter:image" content="https://yoshitsugu.net/images/title.png" />
        <meta name="twitter:description" content="
    Posted on 2018-03-22
    
    
    , Tags: Rust, jailing
    


jailing をRustに置き換えながらjail構築の処理を追ってみた。" />
        <link rel="stylesheet" href="../css/pure-min.css">
        <link rel="stylesheet" href="../css/grids-responsive-min.css">
        <link rel="stylesheet" href="../css/blog.css">
        <link rel="stylesheet" href="../css/highlight.css">
        <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    </head>
    <body>
        <div id="wrapper">
            <div id="container">
                <header id="header" class="pure-menu pure-menu-horizontal">
                    <div id="logo" class="pure-menu-heading pure-menu-link">
                        <a href="../" class="pure-menu-link">TSUGULOG</a>
                    </div>
                    <ul class="pure-menu-list header-menu">
                        <li class="pure-menu-item"><a href="../" class="pure-menu-link">Home</a></li>
                        <li class="pure-menu-item"><a href="../archive.html" class="pure-menu-link">Archive</a></li>
                        <li class="pure-menu-item"><a href="../about.html" class="pure-menu-link">About</a></li>
                    </ul>
                </header>
                <div id="content">
                    <h1>chrootベースのjailをRustで作ってみる</h1>
                    
                    <div class="info">
    <span class="date">Posted on 2018-03-22</span>
    
    
    <span class="tags">, Tags: <a title="All pages tagged 'Rust'." href="../tags/Rust.html" rel="tag">Rust</a>, <a title="All pages tagged 'jailing'." href="../tags/jailing.html" rel="tag">jailing</a></span>
    
</div>

<p><a href="https://github.com/kazuho/jailing">jailing</a> をRustに置き換えながらjail構築の処理を追ってみた。<!--more--></p>
<h2 id="目的">目的</h2>
<p><a href="http://blog.yuuk.io/entry/diy-container">自作Linuxコンテナの時代</a>というy_uuk1さんが書いたブログ記事を最近読み直すことがあった。その中で触れられていたkazuhoさんの<a href="https://github.com/kazuho/jailing">jailing</a>のコードを眺めていたところ、これをRustで書いたらRustの勉強+jailingの勉強にもなってよいのではないか、と思った。</p>
<h2 id="やってみる">やってみる</h2>
<h3 id="処理の概要">処理の概要</h3>
<p>perlはなじみがないが、まず雰囲気をつかむ。</p>
<ol type="1">
<li>/etc や /tmp などのディレクトリを準備する</li>
<li>/bin や /usr/bin などをbindでmountする</li>
<li>/dev を準備する</li>
<li>chrootする</li>
<li>capabilityを制限する</li>
<li>コマンドの実行</li>
</ol>
<p>という流れになっている。</p>
<h3 id="etc-や-tmp-などのディレクトリを準備する">1. /etc や /tmp などのディレクトリを準備する</h3>
<p>まずはこここを実装する。
空ディレクトリの生成、権限の変更(777)、ファイルのコピーをする</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> NEW_DIRS<span class="op">:</span> <span class="op">&amp;</span><span class="ot">'static</span> [<span class="op">&amp;</span><span class="ot">'static</span> <span class="dt">str</span>] <span class="op">=</span> <span class="op">&amp;</span>[<span class="st">&quot;etc&quot;</span><span class="op">,</span> <span class="st">&quot;run&quot;</span><span class="op">,</span> <span class="st">&quot;usr&quot;</span><span class="op">,</span> <span class="st">&quot;var/log&quot;</span>]<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> TMP_DIRS<span class="op">:</span> <span class="op">&amp;</span><span class="ot">'static</span> [<span class="op">&amp;</span><span class="ot">'static</span> <span class="dt">str</span>] <span class="op">=</span> <span class="op">&amp;</span>[<span class="st">&quot;tmp&quot;</span><span class="op">,</span> <span class="st">&quot;run/lock&quot;</span><span class="op">,</span> <span class="st">&quot;var/tmp&quot;</span>]<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> COPY_FILES<span class="op">:</span> <span class="op">&amp;</span><span class="ot">'static</span> [<span class="op">&amp;</span><span class="ot">'static</span> <span class="dt">str</span>] <span class="op">=</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>[<span class="st">&quot;etc/group&quot;</span><span class="op">,</span> <span class="st">&quot;etc/passwd&quot;</span><span class="op">,</span> <span class="st">&quot;etc/resolv.conf&quot;</span><span class="op">,</span> <span class="st">&quot;etc/hosts&quot;</span>]<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> create_dirs(root<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> dirs <span class="op">=</span> NEW_DIRS<span class="op">.</span>to_vec()<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    dirs<span class="op">.</span>extend(TMP_DIRS<span class="op">.</span>iter())<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> d <span class="kw">in</span> dirs <span class="op">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="pp">fs::</span>create_dir_all(<span class="pp">format!</span>(<span class="st">&quot;{}/{}&quot;</span><span class="op">,</span> root<span class="op">,</span> d))<span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to create dir {}&quot;</span><span class="op">,</span> d))<span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> change_dir_permissions(root<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> d <span class="kw">in</span> TMP_DIRS<span class="op">.</span>iter() <span class="op">{</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> metadata <span class="op">=</span> <span class="pp">fs::</span>metadata(<span class="pp">format!</span>(<span class="st">&quot;{}/{}&quot;</span><span class="op">,</span> root<span class="op">,</span> d))<span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to get metadata {}&quot;</span><span class="op">,</span> d))<span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> permissions <span class="op">=</span> metadata<span class="op">.</span>permissions()<span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        permissions<span class="op">.</span>set_mode(<span class="dv">0o777</span>)<span class="op">;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> copy_files(root<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> COPY_FILES <span class="op">{</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="pp">fs::</span>copy(<span class="pp">format!</span>(<span class="st">&quot;/{}&quot;</span><span class="op">,</span> f)<span class="op">,</span> <span class="pp">format!</span>(<span class="st">&quot;{}/{}&quot;</span><span class="op">,</span> root<span class="op">,</span> f))<span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to copy file {}&quot;</span><span class="op">,</span> f))<span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="bin-や-usrbin-などをbindでmountする">2. /bin や /usr/bin などをbindでmountする</h3>
<p>必要なコマンドやライブラリがはいっているディレクトリをbindでmountする。<br />
mountはコマンドをそのまま実行してもよいが、今回は<a href="https://github.com/tailhook/libmount">libmount</a>というcrateを使ってみた。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> BIND_DIRS<span class="op">:</span> <span class="op">&amp;</span><span class="ot">'static</span> [<span class="op">&amp;</span><span class="ot">'static</span> <span class="dt">str</span>] <span class="op">=</span> <span class="op">&amp;</span>[</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;bin&quot;</span><span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;etc/alternatives&quot;</span><span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;etc/pki/tls/certs&quot;</span><span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;etc/pki/ca-trust&quot;</span><span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;etc/ssl/certs&quot;</span><span class="op">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;lib&quot;</span><span class="op">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;lib64&quot;</span><span class="op">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sbin&quot;</span><span class="op">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;usr/bin&quot;</span><span class="op">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;usr/include&quot;</span><span class="op">,</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;usr/lib&quot;</span><span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;usr/lib64&quot;</span><span class="op">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;usr/libexec&quot;</span><span class="op">,</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;usr/sbin&quot;</span><span class="op">,</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;usr/share&quot;</span><span class="op">,</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> bind_mount(root<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> d <span class="kw">in</span> BIND_DIRS <span class="op">{</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> sd <span class="op">=</span> <span class="pp">format!</span>(<span class="st">&quot;/{}&quot;</span><span class="op">,</span> d)<span class="op">;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> rd <span class="op">=</span> <span class="pp">format!</span>(<span class="st">&quot;{}/{}&quot;</span><span class="op">,</span> root<span class="op">,</span> d)<span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">!</span><span class="dt">Path</span><span class="pp">::</span>new(<span class="op">&amp;</span>sd)<span class="op">.</span>exists() <span class="op">{</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> sdm <span class="op">=</span> <span class="pp">fs::</span>metadata(<span class="op">&amp;</span>sd)<span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to get metadata {}&quot;</span><span class="op">,</span> <span class="op">&amp;</span>sd))<span class="op">;</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> sdm<span class="op">.</span>file_type()<span class="op">.</span>is_symlink() <span class="op">{</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> rdm <span class="op">=</span> <span class="pp">fs::</span>metadata(<span class="op">&amp;</span>rd)<span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to get metadata {}&quot;</span><span class="op">,</span> <span class="op">&amp;</span>rd))<span class="op">;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">!</span>rdm<span class="op">.</span>file_type()<span class="op">.</span>is_symlink() <span class="op">{</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                <span class="pp">fs::</span>create_dir_all(</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">Path</span><span class="pp">::</span>new(<span class="op">&amp;</span>rd)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span>parent()</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to get parent dir path {}&quot;</span><span class="op">,</span> <span class="op">&amp;</span>rd))<span class="op">,</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                )<span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to create parent dir {}&quot;</span><span class="op">,</span> <span class="op">&amp;</span>rd))<span class="op">;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> sdl <span class="op">=</span> <span class="pp">fs::</span>read_link(<span class="op">&amp;</span>sd)<span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to read symlink {}&quot;</span><span class="op">,</span> <span class="op">&amp;</span>sd))<span class="op">;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>            <span class="pp">std::os::unix::fs::</span>symlink(sdl<span class="op">,</span> <span class="op">&amp;</span>rd)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to create symlink {}&quot;</span><span class="op">,</span> <span class="op">&amp;</span>rd))<span class="op">;</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>            <span class="pp">fs::</span>create_dir_all(<span class="op">&amp;</span>rd)<span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to create dir {}&quot;</span><span class="op">,</span> <span class="op">&amp;</span>rd))<span class="op">;</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="pp">fs::</span>read_dir(<span class="op">&amp;</span>rd)<span class="op">.</span>unwrap()<span class="op">.</span>count() <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>                <span class="pp">libmount::BindMount::</span>new(<span class="dt">Path</span><span class="pp">::</span>new(<span class="op">&amp;</span>sd)<span class="op">,</span> <span class="dt">Path</span><span class="pp">::</span>new(<span class="op">&amp;</span>rd))</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>recursive(<span class="cn">false</span>)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>readonly(<span class="cn">true</span>)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>mount()</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Failed to mount {} to {}&quot;</span><span class="op">,</span> <span class="op">&amp;</span>sd<span class="op">,</span> <span class="op">&amp;</span>rd))<span class="op">;</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="dev-を準備する">3. /dev を準備する</h3>
<p><code>/dev/null</code>, <code>/dev/zero</code>, <code>/dev/random</code>, <code>/dev/urandom</code> を準備する。<br />
元々のjailingでは<code>mknod</code> というコマンドで準備している。今回は <code>libc</code>の<a href="https://doc.rust-lang.org/libc/x86_64-unknown-linux-gnu/libc/fn.mknod.html">mknod</a>を使った。<br />
このmknodなどのlibcのライブラリの使い方は<a href="https://github.com/uutils/coreutils">coreutils</a>の実装が非常に参考になった。(というか一部そのまま使っている。)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> make_devices(root<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">fs::</span>create_dir_all(<span class="pp">format!</span>(<span class="st">&quot;{}/dev&quot;</span><span class="op">,</span> root))<span class="op">.</span>expect(<span class="st">&quot;Cannot create /dev dir&quot;</span>)<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    make_device_if_not_exists(<span class="pp">format!</span>(<span class="st">&quot;{}/dev/null&quot;</span><span class="op">,</span> root)<span class="op">,</span> <span class="dv">0o666</span><span class="op">,</span> makedev(<span class="dv">1</span><span class="op">,</span> <span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    make_device_if_not_exists(<span class="pp">format!</span>(<span class="st">&quot;{}/dev/zero&quot;</span><span class="op">,</span> root)<span class="op">,</span> <span class="dv">0o666</span><span class="op">,</span> makedev(<span class="dv">1</span><span class="op">,</span> <span class="dv">5</span>))<span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> <span class="op">&amp;</span>[<span class="st">&quot;random&quot;</span><span class="op">,</span> <span class="st">&quot;urandom&quot;</span>] <span class="op">{</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        make_device_if_not_exists(<span class="pp">format!</span>(<span class="st">&quot;{}/dev/{}&quot;</span><span class="op">,</span> root<span class="op">,</span> r)<span class="op">,</span> <span class="dv">0o444</span><span class="op">,</span> makedev(<span class="dv">1</span><span class="op">,</span> <span class="dv">9</span>))<span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> make_device_if_not_exists(path<span class="op">:</span> <span class="dt">String</span><span class="op">,</span> mode<span class="op">:</span> <span class="dt">mode_t</span><span class="op">,</span> dev<span class="op">:</span> <span class="dt">dev_t</span>) <span class="op">{</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">!</span><span class="dt">Path</span><span class="pp">::</span>new(<span class="op">&amp;</span>path)<span class="op">.</span>exists() <span class="op">{</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> err <span class="op">=</span> makenod(<span class="op">&amp;</span>path<span class="op">,</span> <span class="cn">S_IFCHR</span> <span class="op">|</span> mode<span class="op">,</span> dev)<span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        handle_os_error(err<span class="op">,</span> <span class="pp">format!</span>(<span class="st">&quot;{}&quot;</span><span class="op">,</span> path))<span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> makenod(path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">String</span><span class="op">,</span> mode<span class="op">:</span> <span class="dt">mode_t</span><span class="op">,</span> dev<span class="op">:</span> <span class="dt">dev_t</span>) <span class="op">-&gt;</span> <span class="dt">i32</span> <span class="op">{</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">unsafe</span> <span class="op">{</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        mknod(</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            <span class="pp">CString::</span>new(path<span class="op">.</span>as_bytes())</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>expect(<span class="st">&quot;Error in construct CString&quot;</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>as_bytes_with_nul()</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>as_ptr() <span class="kw">as</span> <span class="op">*</span><span class="kw">const</span> <span class="pp">libc::</span><span class="dt">c_char</span><span class="op">,</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>            mode<span class="op">,</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>            dev<span class="op">,</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> makedev(maj<span class="op">:</span> <span class="dt">u64</span><span class="op">,</span> min<span class="op">:</span> <span class="dt">u64</span>) <span class="op">-&gt;</span> <span class="dt">dev_t</span> <span class="op">{</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// pick up from &lt;sys/sysmacros.h&gt;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    ((min <span class="op">&amp;</span> <span class="dv">0xff</span>) <span class="op">|</span> ((maj <span class="op">&amp;</span> <span class="dv">0xfff</span>) <span class="op">&lt;&lt;</span> <span class="dv">8</span>) <span class="op">|</span> (((min <span class="op">&amp;</span> <span class="op">!</span><span class="dv">0xff</span>)) <span class="op">&lt;&lt;</span> <span class="dv">12</span>) <span class="op">|</span> (((maj <span class="op">&amp;</span> <span class="op">!</span><span class="dv">0xfff</span>)) <span class="op">&lt;&lt;</span> <span class="dv">32</span>))</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">as</span> <span class="dt">dev_t</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> handle_os_error<span class="op">&lt;</span>T<span class="op">:</span> <span class="pp">std::fmt::</span><span class="bu">Display</span><span class="op">&gt;</span>(err<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> action<span class="op">:</span> T) <span class="op">{</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">!=</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        <span class="pp">panic!</span>(</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Error: {{action: {}, code: {}, msg: {} }}&quot;</span><span class="op">,</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>            action<span class="op">,</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>            err<span class="op">,</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Error</span><span class="pp">::</span>last_os_error()</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        )<span class="op">;</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="chrootする">4. chrootする</h3>
<p>chrootもコマンドを呼び出してもいいのだが、折角なので、<code>libc</code>の<a href="https://doc.rust-lang.org/libc/x86_64-unknown-linux-gnu/libc/fn.chroot.html">chroot</a>を使った。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> exec_chroot(root<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">std::env::</span>set_current_dir(<span class="op">&amp;</span>root)<span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Cannot change current dir to {}&quot;</span><span class="op">,</span> <span class="op">&amp;</span>root))<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> err <span class="op">=</span> <span class="kw">unsafe</span> <span class="op">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        chroot(<span class="pp">CString::</span>new(<span class="st">&quot;.&quot;</span><span class="op">.</span>as_bytes())</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>expect(<span class="st">&quot;Error in construct CString&quot;</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>as_bytes_with_nul()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>as_ptr() <span class="kw">as</span> <span class="op">*</span><span class="kw">const</span> <span class="pp">libc::</span><span class="dt">c_char</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    handle_os_error(err<span class="op">,</span> <span class="st">&quot;chroot&quot;</span>)<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="capabilityを制限する">5. capabilityを制限する</h3>
<p>capabilityについてあまり理解できていなかったため、manや<a href="http://udzura.hatenablog.jp/entry/2016/06/24/181852">Linux Capability - ケーパビリティについての整理</a>を参考にした。<br />
また、capabilityの操作は<a href="https://github.com/lucab/caps-rs">caps-rs</a>を使用した。(結構有用そうなのにスター数が少なくて悲しい。)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> drop_capabilities() <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> allowed_caps <span class="op">=</span> <span class="pp">vec!</span>[</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="pp">Capability::</span>CAP_SETGID<span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="pp">Capability::</span>CAP_SETGID<span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="pp">Capability::</span>CAP_NET_BIND_SERVICE<span class="op">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cur <span class="op">=</span> <span class="pp">caps::</span>read(<span class="cn">None</span><span class="op">,</span> <span class="pp">CapSet::</span>Bounding)<span class="op">.</span>expect(<span class="st">&quot;Cannot read capabilities&quot;</span>)<span class="op">;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> cur <span class="op">{</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> allowed_caps<span class="op">.</span>contains(<span class="op">&amp;</span>c) <span class="op">{</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="pp">caps::</span>drop(<span class="cn">None</span><span class="op">,</span> <span class="pp">CapSet::</span>Bounding<span class="op">,</span> c)<span class="op">.</span>expect(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;Cannot drop capability {}&quot;</span><span class="op">,</span> c))<span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="コマンドの実行">6. コマンドの実行</h3>
<p>最後に、chroot環境で、コマンドを実行する。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> exec_command<span class="op">&lt;</span><span class="ot">'a</span><span class="op">&gt;</span>(commands<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="pp">clap::</span>Values<span class="op">&gt;</span>) <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cmds <span class="op">=</span> <span class="cf">match</span> commands <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Some</span>(vs) <span class="op">=&gt;</span> vs<span class="op">.</span>map(<span class="op">|</span>v<span class="op">|</span> v)<span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;&amp;</span><span class="dt">str</span><span class="op">&gt;&gt;</span>()<span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="cn">None</span> <span class="op">=&gt;</span> <span class="pp">vec!</span>[<span class="st">&quot;bash&quot;</span><span class="op">,</span> <span class="st">&quot;-i&quot;</span>]<span class="op">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> _ <span class="op">=</span> <span class="pp">Command::</span>new(cmds[<span class="dv">0</span>])</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>args(<span class="op">&amp;</span>cmds[<span class="dv">1</span><span class="op">..</span>])</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>status()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>unwrap_or_else(<span class="op">|</span>e<span class="op">|</span> <span class="pp">panic!</span>(<span class="st">&quot;Cannot exec: {}&quot;</span><span class="op">,</span> e))<span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="コマンド化">コマンド化</h2>
<p>上記をベースに、<code>jl</code>という名前でコマンドを作った。<br />
コードは<a href="https://github.com/yoshitsugu/jl">https://github.com/yoshitsugu/jl</a>に置いてある。</p>
<h2 id="動かす">動かす</h2>
<p><code>/opt/jail</code>というディレクトリを作ってそこで実験してみる</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo mkdir /opt/jail</span></code></pre></div>
<p><code>jl</code>経由で<code>bash</code>起動</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo jl <span class="at">--root</span> bash</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">bash-4.4#</span></span></code></pre></div>
<p><code>ls</code>とか<code>pwd</code>をためしてみる</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bash-4.4#</span> ls</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bin</span>  dev  etc  lib  lib64  run  sbin  tmp  usr  var</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">bash-4.4#</span> pwd</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/</span></span></code></pre></div>
<p>capability上許可されていないはずの<code>kill</code>や<code>chown</code>をためしてみる</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bash-4.4#</span> kill 26559</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bash:</span> kill: <span class="er">(</span><span class="ex">26559</span><span class="kw">)</span> <span class="ex">-</span> 許可されていない操作です</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">bash-4.4#</span> touch /var/log/hoge</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">bash-4.4#</span> chown 1000 /var/log/hoge</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">chown:</span> <span class="st">'var/log/hoge'</span> の所有者を変更中: 許可されていない操作です</span></code></pre></div>
<p>ちなみに、<code>jl</code>コマンドにそのままコマンドを渡すこともできる</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo jl <span class="at">--root</span> /opt/jail ls</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bin</span>  dev  etc  lib  lib64  run  sbin  tmp  usr  var</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo jl <span class="at">--root</span> /opt/jail <span class="at">--</span> ruby <span class="at">-e</span> <span class="st">&quot;puts 'hello'&quot;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">hello</span></span></code></pre></div>
<h2 id="まとめ">まとめ</h2>
<ul>
<li><a href="https://github.com/kazuho/jailing">jailing</a>のコードを読みながらRustでchrootベースのjail構築ができるようにした。
<ul>
<li><a href="https://github.com/yoshitsugu/jl">https://github.com/yoshitsugu/jl</a></li>
</ul></li>
<li>custom bindingなど元のjailingにあるもので実装していないものもあるので、その辺はまた今度。</li>
<li>Linux capabilityやRustでlibcを使う方法など勉強になった。</li>
</ul>

<div class="social-buttons">
<a href="http://b.hatena.ne.jp/entry/https://yoshitsugu.net/posts/2018-03-22-jailing-in-rust.html" class="hatena-bookmark-button" data-hatena-bookmark-title="chrootベースのjailをRustで作ってみる - TSUGULOG" data-hatena-bookmark-layout="standard-noballoon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<a href="https://twitter.com/share" class="twitter-share-button" data-via="_yoshitsugu">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>

                    
                </div>
            </div>
            <footer id="footer">
                &copy; 2016 Kota Yoshitsugu <br>
                This site is powered by
                <a href="http://jaspervdj.be/hakyll" target="_blank">Hakyll</a>
                , <a href="http://purecss.io/" target="_blank">Pure.css</a>
        </footer>
        
      </div>
    </body>
</html>
